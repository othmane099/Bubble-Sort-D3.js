<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP3</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>

</head>

<body>
    <h1>TP3 | EXO1_3</h1>
    <select id="label-type">
        <option value="var1">var1 </option>
        <option value="var2">var2 </option>
    </select>

    <script>
        let width = 400,
            height = 400;

        const margin = { top: 20, right: 20, bottom: 20, left: 20 };
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;

        let dataset = []
        d3.csv('data.csv', (err, data) => {
            if (err) console.log(err)
            else {
                dataset = data
                console.log(dataset)

                let svg = d3.select("body")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);

                let xScale = d3.scaleBand()
                    .range([0, innerWidth])
                    .padding(0.01)

                let yScale = d3.scaleLinear()
                    .range([innerHeight, margin.top]);

                let xAxis = d3.axisBottom(xScale)
                let yAxis = d3.axisLeft(yScale)

                let color = d3.scaleSequential(d3.interpolateViridis)
                    .domain([0, 20]);

                svg.append("g")
                    .attr("class", "x axis")
                    .attr('transform', `translate(${margin.left}, ${innerHeight})`)

                svg.append("g")
                    .attr("class", "y axis")
                    .attr("transform", "translate(" + margin.left + ",0)")

                draw('var1');

                function draw(vars) {

                    let data = dataset;

                    xScale.domain(data.map(d => d.group))

                    let maxVar = d3.max(data, (d, i) => parseInt(d[vars]))
                    yScale.domain([0, maxVar])

                    let bars = svg.selectAll(".bars")
                        .data(data);

                    bars.enter()
                        .append("rect")
                        .attr("class", "bars")
                        .attr("x", d => xScale(d.group) + margin.left)
                        .attr("y", d => yScale(d[vars]))
                        .attr("width", d => xScale.bandwidth())
                        .attr("height", d => innerHeight - yScale(d[vars]))
                        .attr("fill", 'steelblue')
                        .merge(bars).transition()
                        .duration(1000)
                        .delay(1000)
                        .attr("y", d => yScale(d[vars]))
                        .attr("height", d => innerHeight - yScale(d[vars]))

                    bars.exit()
                        .transition()
                        .duration(1000)
                        .attr("width", 0)
                        .remove();

                    d3.select(".y.axis")
                        .transition()
                        .duration(1000)
                        .delay(750)
                        .call(yAxis);

                    d3.select(".x.axis")
                        .transition()
                        .duration(1000)
                        .delay(750)
                        .call(xAxis);
                }

                d3.select('select')
                    .on('change', d => {
                        sel = d3.select('#label-type').node().value
                        draw(sel)
                    })

            }
        })



    </script>
</body>

</html>